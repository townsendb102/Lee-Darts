<body>
<header>
    <div style="display:flex; flex-direction:column">
        <span>ID: <b id="my-id" style="color:var(--blue)">...</b></span>
        <button onclick="initCam()" id="cam-auth-btn" style="background:red; color:white; border:none; border-radius:4px; font-size:10px; padding:2px 5px; margin-top:2px;">TAP TO ALLOW CAMERA</button>
    </div>
    <div style="display:flex; gap:5px">
        <input type="text" id="p-id" placeholder="Friend ID" style="width:70px; height:24px; font-size:10px; padding:0 5px">
        <button onclick="join()" class="btn" style="background:var(--blue); padding:0 8px; color:black; height:24px">LINK</button>
    </div>
</header>

<div class="cam-grid">
    <div class="v-box"><video id="me" autoplay playsinline muted></video></div>
    <div class="v-box"><video id="peer" autoplay playsinline></video></div>
</div>

<script>
    // UPDATED CAMERA LOGIC
    async function initCam() {
        const btn = document.getElementById('cam-auth-btn');
        
        // Use standard constraints - simpler is better for permissions
        const constraints = { 
            video: { facingMode: currentFacing }, 
            audio: true 
        };

        try {
            // This is the line that triggers the browser pop-up
            localStream = await navigator.mediaDevices.getUserMedia(constraints);
            
            const v = document.getElementById('me');
            v.srcObject = localStream;
            
            // Clean up UI after success
            btn.style.background = "var(--blue)";
            btn.innerText = "CAMERA ACTIVE";
            btn.disabled = true;

            // Keep screen awake
            if ('wakeLock' in navigator) wakeLock = await navigator.wakeLock.request('screen');
            
        } catch (e) {
            console.error(e);
            alert("PERMISSION ERROR: Please close all other apps (Facebook Bubbles, etc.) and ensure you are on HTTPS.");
        }
    }
    
    // ... Rest of your PeerJS and Scoring logic remains the same ...
</script>
</body>
